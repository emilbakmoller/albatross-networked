.PHONY = all elliptic clean distclean help
CFLAGS= -O3 -march=native -mtune=native
RELIC_ROOT = relic

all: lib elliptic

elliptic:
	$(CXX) ${CFLAGS} -c main.cpp -o main.o -I ${RELIC_ROOT}/include -I target/include
	$(CXX) ${CFLAGS} -o main main.o target/lib/librelic_s.a -lgmp

lib:
	mkdir -p target
	cd target; ../${RELIC_ROOT}/preset/gmp-ecc-tweedledum.sh ../${RELIC_ROOT}/; cmake -DEP_METHD='JACOB;LWNAF;COMBS;INTER' .; make

clean:
	rm *.o main

distclean:
	rm -rf target *.o main

help:
	@echo "Usage:"
	@echo "  make [all]		Build the library relic and the software"
	@echo "  make elliptic		Build only the software (if the library is already built)"
	@echo "  make distclean	Remove all files generated by make"
	@echo "  make clean		Remove all files generated by the make except the library target"
	@echo "  make help		Display the main targets of this Makefile with a short description"
