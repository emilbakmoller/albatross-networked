.PHONY = all albatros clean distclean help

TARGET = albatross
SRCDIR = src
RELIC_ROOT = relic

SRC = $(wildcard $(SRCDIR)/*.cpp)
OBJ = $(SRC:.cpp=.o)

LDLIBS = target/lib/librelic_s.a -lgmp
CXXFLAGS = -Wall -Wextra -O3 -march=native -mtune=native -march=native
RELICINCLUDES = -I$(RELIC_ROOT)/include -Itarget/include
INCLUDES = -Iinclude

all: lib $(TARGET)

$(TARGET): $(OBJ)
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDLIBS)

%.o: %.cpp
	$(CXX) $(CXXFLAGS) -c -o $@ $^ $(INCLUDES) $(RELICINCLUDES)

main.o: pvss.hpp
pvss.o: pvss.hpp func.hpp

lib:
	mkdir -p target
	cd target; ../$(RELIC_ROOT)/preset/gmp-ecc-tweedledum.sh ../$(RELIC_ROOT)/; cmake -DEP_METHD='BASIC;LWNAF;COMBS;INTER' .; make

clean:
	@$(RM) $(OBJ) *~ $(TARGET)

distclean:
	@$(RM) -rf target $(OBJ) *~ $(TARGET)

help:
	@echo "Usage:"
	@echo "  make [all]		Build the library relic and the software"
	@echo "  make elliptic		Build only the software (if the library is already built)"
	@echo "  make distclean	Remove all files generated by make"
	@echo "  make clean		Remove all files generated by the make except the library target"
	@echo "  make help		Display the main targets of this Makefile with a short description"
